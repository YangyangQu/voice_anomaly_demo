<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Conversion Analysis | FreeVC-Alpha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* 自定义滑块样式 */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #4F46E5;
            cursor: pointer;
            margin-top: -10px;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.4);
            transition: transform 0.1s;
            border: 2px solid white;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #E5E7EB;
            border-radius: 3px;
        }

        audio { width: 100%; height: 40px; opacity: 0.95; }

        /* 图片放大特效 */
        .zoom-image { transition: transform 0.3s ease; }
        .zoom-image:hover { transform: scale(1.02); }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

    <header class="bg-white sticky top-0 z-30 shadow-sm border-b border-gray-100">
        <div class="h-1.5 w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>

        <div class="max-w-6xl mx-auto py-6 px-6 md:px-8">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <div class="flex items-center gap-3">
                        <span class="bg-indigo-600 text-white text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wider">Demo</span>
                        <h1 class="text-3xl font-bold text-gray-900 tracking-tight">
                            Voice Conversion Analysis
                        </h1>
                    </div>
                    <p class="mt-2 text-gray-500 text-sm max-w-2xl leading-relaxed">
                        基于 <span class="font-semibold text-indigo-600">FreeVC-Alpha</span> 模型的语音隐私保护评估。
                        通过调节混合比例 <span class="font-mono text-xs bg-gray-100 px-1 py-0.5 rounded">0.0 - 1.0</span>，实时观测语音质量 (WER/CER) 与声纹相似度 (EER/SIM) 的权衡关系。
                    </p>
                </div>

                <div class="flex items-center gap-3">
                     <div class="text-right hidden md:block">
                        <p class="text-xs text-gray-400 uppercase font-semibold">Step Size</p>
                        <p class="font-mono text-indigo-600 font-bold">0.02</p>
                     </div>
                     <div class="h-8 w-[1px] bg-gray-200 hidden md:block"></div>
                     <div class="text-right hidden md:block">
                        <p class="text-xs text-gray-400 uppercase font-semibold">Samples</p>
                        <p class="font-mono text-gray-800 font-bold">4 Cases</p>
                     </div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-6xl mx-auto w-full py-10 px-6 space-y-8" id="content-area">
        <div class="flex justify-center py-20">
            <div class="animate-pulse flex space-x-4">
                <div class="rounded-full bg-gray-200 h-10 w-10"></div>
                <div class="flex-1 space-y-6 py-1">
                    <div class="h-2 bg-gray-200 rounded w-60"></div>
                    <div class="space-y-3">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="h-2 bg-gray-200 rounded col-span-2"></div>
                            <div class="h-2 bg-gray-200 rounded col-span-1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <section class="bg-white border-t border-gray-200 py-16">
        <div class="max-w-6xl mx-auto px-6">
            <div class="text-center mb-10">
                <h2 class="text-2xl font-bold text-gray-900">综合指标可视化</h2>
                <p class="mt-2 text-gray-500">Evaluation Metrics: WER, CER, EER & Similarity</p>
            </div>

            <div class="bg-gray-50 rounded-2xl border border-gray-100 p-4 shadow-inner overflow-hidden">
                <img src="assets/results_plot.png"
                     alt="Analysis Results Plot"
                     class="w-full h-auto object-contain rounded-xl zoom-image mx-auto shadow-sm border border-gray-200"
                     style="max-height: 600px;"> <div class="mt-4 flex justify-center gap-6 text-xs text-gray-400">
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span> WER (Word Error Rate)</span>
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500"></span> CER (Character Error Rate)</span>
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span> EER (Equal Error Rate)</span>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-900 text-white py-12 border-t border-gray-800">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-gray-400 text-sm">
                &copy; 2025 Voice Conversion Analysis Tool. All rights reserved.
            </div>
            <div class="flex gap-6 text-sm font-medium text-gray-400">
                <a href="#" class="hover:text-white transition-colors">GitHub</a>
                <a href="#" class="hover:text-white transition-colors">Paper</a>
                <a href="#" class="hover:text-white transition-colors">About</a>
            </div>
        </div>
    </footer>

    <script>
        // ... (CSV 数据保持不变，此处省略，为了节省篇幅，请保留你原来的 CSV 数据) ...
        const csvRawContent = `alpha,SIM_orig,WER_orig,CER_orig,SIM_anon,WER_anon,CER_anon,EER_orig,EER_orig_anon
0.00,1.0000000315904618,0.07597361582346103,0.044655803304070055,0.6490722903029786,0.10779175871332733,0.05902968726917552,0.11361797526478767,0.16033707559108734
0.02,1.0000000315904618,0.07692599677584197,0.047248395896662645,0.6483121124986145,0.11466633622464374,0.0643796930466812,0.11361797526478767,0.15821348875761032
0.04,1.0000000315904618,0.0756561555060007,0.044573498777321086,0.6478215316931407,0.10460409644439571,0.05830946594751492,0.11361797526478767,0.15552809089422226
0.06,1.0000000315904618,0.07486250471234991,0.04309201729583959,0.6462479306012392,0.12843021262267906,0.08342895258450073,0.11361797526478767,0.15821348875761032
0.08,1.0000000315904618,0.07978313963298483,0.05132246997073672,0.6439550109538767,0.10161768041231407,0.05862194523927206,0.11361797526478767,0.16033707559108734
0.10,1.0000000315904618,0.07438631423615943,0.04354469219295894,0.6417936044103569,0.12078994504329901,0.0723817148251753,0.11361797526478767,0.16770786046981812
0.12,1.0000000315904618,0.07422758407742928,0.04317432182258857,0.6415545386241542,0.10227670443305119,0.05898056334254817,0.11361797526478767,0.1655842661857605
0.14,1.0000000315904618,0.07517996502981024,0.0436681489830824,0.6386316541996268,0.11235950309866718,0.07279072558481518,0.11361797526478767,0.16614606231451035
0.16,1.0000000315904618,0.07883075868060388,0.05012905433287664,0.6352587507168452,0.1047996797568521,0.05786883039599671,0.11361797526478767,0.16614606231451035
0.18,1.0000000315904618,0.07597361582346103,0.04572576215180668,0.6312765273369021,0.09989784429154915,0.05715878719520575,0.11361797526478767,0.16614606231451035
0.20,1.0000000315904618,0.07470377455361975,0.04247473334522232,0.6288576609227392,0.10286236283114508,0.05614830919293357,0.11361797526478767,0.17564044892787933
0.22,1.0000000315904618,0.07740218725203246,0.04831835474439927,0.6237267803814676,0.10348332326428301,0.05903854948824078,0.11361797526478767,0.17407865077257156
0.24,1.0000000315904618,0.07486250471234991,0.04321547408596305,0.6202005988690589,0.10650514717671579,0.05936493468595524,0.11361797526478767,0.18569663166999817
0.26,1.0000000315904618,0.07549742534727054,0.04440888972382314,0.6149752776076396,0.10150917455819417,0.058547095259651245,0.11361797526478767,0.1841348335146904
0.28,1.0000000315904618,0.07438631423615943,0.04354469219295894,0.6091218254384068,0.10815554556860027,0.06373882818577353,0.11361797526478767,0.1957528069615364
0.30,1.0000000315904618,0.07502123487108006,0.04407967161682726,0.6033353628963232,0.1062738125116866,0.06166935878511055,0.11361797526478767,0.1899438202381134
0.32,1.0000000315904618,0.07819583804568325,0.04827720248102479,0.5958407543061508,0.11268765341985156,0.06580574585795702,0.11361797526478767,0.1957528069615364
0.34,1.0000000315904618,0.07486250471234991,0.04354469219295894,0.5868410048302677,0.12694138249091808,0.07926529452357735,0.11361797526478767,0.20580898970365524
0.36,1.0000000315904618,0.07581488566473085,0.04482041235756799,0.5772300666653448,0.10522260831703556,0.05849408881193454,0.11361797526478767,0.21161797642707825
0.38,1.0000000315904618,0.0756561555060007,0.044738107830819024,0.5662313226362069,0.10611020334059551,0.06317741185190917,0.11361797526478767,0.2179887592792511
0.40,1.0000000315904618,0.07629107614092134,0.046960330053041247,0.5546785709758599,0.11237219534278357,0.064417027883526,0.11361797526478767,0.2237977534532547
0.42,1.0000000315904618,0.07486250471234991,0.044161976143576226,0.5382718547599183,0.11160424807199831,0.06290880573802898,0.11361797526478767,0.2402247190475464
0.44,1.0000000315904618,0.07629107614092133,0.044161976143576226,0.5214794294867251,0.10359597697910392,0.060401894023324666,0.11361797526478767,0.2539663016796112
0.46,1.0000000315904618,0.07517996502981024,0.043750453509831366,0.504245254273216,0.12926011916646593,0.07929795427432776,0.11361797526478767,0.2624606788158417
0.48,1.0000000315904618,0.07486250471234991,0.04407967161682726,0.4828025884874579,0.12537215654811115,0.08222297981526458,0.11361797526478767,0.27564044296741486
0.50,1.0000000315904618,0.07470377455361975,0.043462387666209974,0.46354848588713343,0.10864165885141118,0.06246111102209727,0.11361797526478767,0.29631461203098297
0.52,1.0000000315904618,0.07517996502981023,0.044244280670325195,0.44491358049213886,0.11013993400629109,0.06420458574376421,0.11361797526478767,0.3179887533187866
0.54,1.0000000315904618,0.07517996502981024,0.0439562148267038,0.42881233252171014,0.13182151845593537,0.0869175873510519,0.11361797526478767,0.33385393023490906
0.56,1.0000000315904618,0.07502123487108006,0.043750453509831366,0.4119280022951878,0.1225007915869629,0.07203603114687347,0.11361797526478767,0.3423483222723007
0.58,1.0000000315904618,0.07756091741076261,0.047371852686786106,0.3957565133092511,0.12437805664121454,0.07927230637155508,0.11361797526478767,0.3603370785713196
0.60,1.0000000315904618,0.07629107614092134,0.04564345762505771,0.3852211323152814,0.12053336127046138,0.07090044180092138,0.11361797526478767,0.3740786612033844
0.62,1.0000000315904618,0.07438631423615943,0.043462387666209974,0.3742192848492414,0.1174303594200395,0.07118849414562771,0.11361797526478767,0.387820228934288
0.64,1.0000000315904618,0.07470377455361975,0.043256626349337544,0.36422062625461776,0.11791325773756114,0.06712731665586542,0.11361797526478767,0.387820228934288
0.66,1.0000000315904618,0.07454504439488958,0.042968560505716145,0.3560203904182547,0.1255922660644023,0.07620143941388231,0.11361797526478767,0.4042471945285797
0.68,1.0000000315904618,0.07470377455361975,0.04342123540283549,0.34792054617182455,0.11011154614792386,0.06342037195129385,0.11361797526478767,0.4021236002445221
0.70,1.0000000315904618,0.07486250471234991,0.04469695556744454,0.34248748583719135,0.12067690306673794,0.06904428166709632,0.11361797526478767,0.4195505529642105
0.72,1.0000000315904618,0.07486250471234991,0.04300971276909063,0.33642795863613073,0.12182356396804282,0.07186642345115145,0.11361797526478767,0.42011235654354095
0.74,1.0000000315904618,0.0756561555060007,0.04564345762505771,0.3306205388613873,0.12912390369253113,0.07756308779694039,0.11361797526478767,0.4280449450016022
0.76,1.0000000315904618,0.07470377455361975,0.043256626349337544,0.32512838393605004,0.11814149983525628,0.06810723921848919,0.11361797526478767,0.438101127743721
0.78,1.0000000315904618,0.0794656793155245,0.050334815649749065,0.320076545326867,0.11939835561945983,0.07023790958948897,0.11361797526478767,0.434415727853775
0.80,1.0000000315904618,0.07502123487108006,0.04461465104069558,0.3169319625427791,0.1175104653115489,0.06437115727037221,0.11361797526478767,0.438101127743721
0.82,1.0000000315904618,0.07549742534727054,0.04387391029995483,0.3125037817719082,0.10909998196582305,0.06183360843726322,0.11361797526478767,0.45608988404273987
0.84,1.0000000315904618,0.0756561555060007,0.04560230536168323,0.3082134536974546,0.1282175399229063,0.07608428541553555,0.11361797526478767,0.44815731048583984
0.86,1.0000000315904618,0.07470377455361975,0.04292740824234166,0.3057229471707898,0.1313913971782909,0.07992632797720287,0.11361797526478767,0.4439101219177246
0.88,1.0000000315904618,0.07486250471234991,0.043256626349337544,0.3005111552464465,0.13633893880075512,0.08983309773905426,0.11361797526478767,0.43753932416439056
0.90,1.0000000315904618,0.07486250471234991,0.043503539929584466,0.2973581265492572,0.11725580892944154,0.06755322619686031,0.11361797526478767,0.4417865127325058
0.92,1.0000000315904618,0.07470377455361975,0.04362699671970791,0.2947108134798085,0.12672616217249857,0.07185440325269143,0.11361797526478767,0.449719101190567
0.94,1.0000000315904618,0.07438631423615943,0.04321547408596305,0.2916540798984675,0.12724207415487085,0.07544317921710914,0.11361797526478767,0.45396628975868225
0.96,1.0000000315904618,0.1760321462338481,0.15594145085871802,0.2882493908982724,0.16469696407915946,0.14112481478856456,0.11361797526478767,0.46189887821674347
0.98,1.0000000315904618,0.07454504439488958,0.04259819013534577,0.28581281015856397,0.12319187710389981,0.07190103241328376,0.11361797526478767,0.4555280953645706
1.00,1.0000000315904618,0.07629107614092133,0.04609613252217705,0.2849327354839382,0.13057399603607034,0.07330492573262169,0.11361797526478767,0.4582134783267975
`;

        const examples = [
            {
                id: 1,
                title: "Sample 1: Male_to_Male",
                // ⚠️ 请去 m_m 文件夹里看一眼文件全名，把 _a0_00.wav 之前的部分填在这里
                prefix: "m_m/p226_003__TO__p246_141",
                original: "original/p226_003.wav"
            },
            {
                id: 2,
                title: "Sample 2: Male_to_Female",
                // ⚠️ 去 m_f 文件夹确认文件名
                prefix: "m_f/p226_003__TO__p264_243",
                original: "original/p226_003.wav"
            },
            {
                id: 3,
                title: "Sample 3: Female_to_Male",
                // ⚠️ 去 f_m 文件夹确认文件名
                prefix: "f_m/p264_002__TO__p226_003",
                original: "original/p264_002.wav"
            },
            {
                id: 4,
                title: "Sample 4: Female_to_Female",
                // ✅ 这个是根据你的截图 image_e0dd72.png 确认过的
                prefix: "f_f/p264_002__TO__p301_346",
                original: "original/p264_002.wav"
            },
        ];

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = {};
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length < headers.length) continue;
                const alphaIndex = headers.indexOf('alpha');
                let alphaKey = parseFloat(values[alphaIndex]).toFixed(2);
                data[alphaKey] = {
                    wer: (parseFloat(values[headers.indexOf('WER_anon')]) * 100).toFixed(2) + '%',
                    cer: (parseFloat(values[headers.indexOf('CER_anon')]) * 100).toFixed(2) + '%',
                    eer: (parseFloat(values[headers.indexOf('EER_orig_anon')]) * 100).toFixed(2) + '%'
                };
            }
            return data;
        }

        const metricsData = parseCSV(csvRawContent);
        const container = document.getElementById('content-area');

        container.innerHTML = '';
        examples.forEach(ex => {
            const card = document.createElement('div');
            card.className = "bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden";
            const defaultAlpha = "0.00";
            const metrics = metricsData[defaultAlpha] || { wer: "-", cer: "-", eer: "-" };
            const initialSrc = getAudioPath(ex.prefix, defaultAlpha);

            card.innerHTML = `
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                        <span class="w-2 h-6 bg-indigo-500 rounded-sm"></span>
                        ${ex.title}
                    </h2>
                    <span class="text-xs font-mono bg-white border border-gray-200 px-2 py-1 rounded text-gray-500">ID: ${ex.id}</span>
                </div>

                <div class="p-6 grid grid-cols-1 lg:grid-cols-12 gap-8 items-center">
                    <div class="lg:col-span-3 flex flex-col items-center gap-2">
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Original</span>
                        <audio controls src="${ex.original}" class="rounded-lg bg-gray-100"></audio>
                    </div>

                    <div class="lg:col-span-6 flex flex-col gap-4 bg-indigo-50/50 p-4 rounded-xl border border-indigo-100">
                         <div class="flex justify-between items-end mb-1">
                            <span class="text-xs font-bold text-indigo-400 uppercase tracking-wider">Converted (Alpha Control)</span>
                            <div class="font-mono text-xl font-bold text-indigo-600" id="val-${ex.id}">${defaultAlpha}</div>
                        </div>

                        <audio id="audio-${ex.id}" controls src="${initialSrc}" class="rounded-lg shadow-sm"></audio>

                        <div class="relative pt-2">
                            <input type="range" min="0" max="1" step="0.02" value="0"
                                class="w-full relative z-10"
                                oninput="updateCard(${ex.id}, this.value, '${ex.prefix}')">
                            <div class="flex justify-between text-[10px] text-gray-400 font-mono mt-2 px-1">
                                <span>0.00</span>
                                <span>0.50</span>
                                <span>1.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-3">
                        <div class="grid grid-cols-1 gap-3">
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 flex justify-between items-center">
                                <span class="text-xs text-gray-500 font-semibold">WER</span>
                                <span class="font-mono text-sm font-bold text-gray-800" id="wer-${ex.id}">${metrics.wer}</span>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 flex justify-between items-center">
                                <span class="text-xs text-gray-500 font-semibold">CER</span>
                                <span class="font-mono text-sm font-bold text-gray-800" id="cer-${ex.id}">${metrics.cer}</span>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 flex justify-between items-center">
                                <span class="text-xs text-gray-500 font-semibold">EER</span>
                                <span class="font-mono text-sm font-bold text-gray-800" id="eer-${ex.id}">${metrics.eer}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });

        function getAudioPath(prefix, value) {
            // value 是 "0.00", "0.02", "1.00" 等字符串

            // 1. 解析为数字，乘以 100 (0.02 -> 2)
            // 2. 取整并补零 (2 -> "02", 0 -> "00", 50 -> "50")
            let fileSuffix = (parseFloat(value) * 100).toFixed(0).padStart(2, '0');
            return `${prefix}_a0_${fileSuffix}.wav`;
        }

        function updateCard(id, value, prefix) {
            const formattedVal = parseFloat(value).toFixed(2);
            document.getElementById(`val-${id}`).innerText = formattedVal;

            const audioEl = document.getElementById(`audio-${id}`);
            const newSrc = getAudioPath(prefix, formattedVal);

            if (!audioEl.src.endsWith(newSrc.split('/').pop())) {
                const isPlaying = !audioEl.paused;
                const currentTime = audioEl.currentTime;
                audioEl.src = newSrc;
                if (isPlaying) {
                    audioEl.load();
                    audioEl.currentTime = currentTime;
                    audioEl.play().catch(e => {});
                }
            }

            const metrics = metricsData[formattedVal];
            if (metrics) {
                document.getElementById(`wer-${id}`).innerText = metrics.wer;
                document.getElementById(`cer-${id}`).innerText = metrics.cer;
                document.getElementById(`eer-${id}`).innerText = metrics.eer;
            } else {
                document.getElementById(`wer-${id}`).innerText = "-";
                document.getElementById(`cer-${id}`).innerText = "-";
                document.getElementById(`eer-${id}`).innerText = "-";
            }
        }
    </script>
</body>
</html>